(()=>{"use strict";function e(e,t){var n=(e=document.querySelector(e)).getBoundingClientRect().top+window.pageYOffset-document.querySelector(".navbar").offsetHeight,o=window.pageYOffset,l=n-o,a=null;requestAnimationFrame((function e(n){null===a&&(a=n);var s=n-a,c=function(e,t,n,o){return(e/=o/2)<1?n/2*e*e+t:-n/2*(--e*(e-2)-1)+t}(s,o,l,t);window.scrollTo(0,c),s<t&&requestAnimationFrame(e)}))}async function t(){if(!window.solana||!window.solana.isPhantom)return console.log("not found wallet"),{};try{const e=await window.solana.connect();return console.log("Address:",e.publicKey.toString()),e}catch(e){console.log("Error:",e)}}function n(){const e=document.createElement("input");e.value=window.solana.publicKey.toString(),document.body.appendChild(e),e.select(),e.setSelectionRange(0,9999),document.execCommand("copy"),document.body.removeChild(e),alert("已複製金鑰")}function o(){const e=document.getElementById("loading-spinner");e&&(e.style.display="block")}function l(){const e=document.getElementById("loading-spinner");e&&(e.style.display="none")}const a=[{avatar:"https://via.placeholder.com/50",nickname:"John Doe",bonkCount:15,status:"Stretching"},{avatar:"https://via.placeholder.com/50",nickname:"Jane Smith",bonkCount:8,status:"Idle"},{avatar:"https://via.placeholder.com/50",nickname:"Alice Green",bonkCount:12,status:"Idle"},{avatar:"https://via.placeholder.com/50",nickname:"Bob Brown",bonkCount:20,status:"Stretching"},{avatar:"https://via.placeholder.com/50",nickname:"Lucy Black",bonkCount:5,status:"Idle"},{avatar:"https://via.placeholder.com/50",nickname:"Tom White",bonkCount:9,status:"Idle"}],s=[{avatar:"https://via.placeholder.com/50",nickname:"Chris Blue"},{avatar:"https://via.placeholder.com/50",nickname:"Sophie Red"}];let c=1,d="friends";const i=document.getElementById("friends-invites-tbody"),r=document.getElementById("prev-page"),y=document.getElementById("next-page"),m=document.getElementById("current-page"),u=document.getElementById("friend-back-to-game"),p=document.getElementById("tab-friends"),g=document.getElementById("tab-invites"),E=document.getElementById("table-header-bonk"),h=document.getElementById("table-header-status"),v=document.getElementById("game_ui"),b=document.getElementById("friend");function f(e,t){const n="friends"===t?a:s,o=5*(e-1),l=o+5,c=n.slice(o,l);i.innerHTML="","friends"===t?(E.style.display="table-cell",h.style.display="table-cell",c.forEach((e=>{const t=document.createElement("tr");t.innerHTML=`\n                <td><img src="${e.avatar}" alt="Avatar" class="friend-avatar"></td>\n                <td>${e.nickname}</td>\n                <td>${e.bonkCount}</td>\n                <td><span class="status ${"Stretching"===e.status?"status-green":"status-red"}">${e.status}</span></td>\n                <td><button class="bonk-btn">BONK!</button></td>\n            `,i.appendChild(t)}))):"invites"===t&&(E.style.display="none",h.style.display="none",c.forEach((e=>{const t=document.createElement("tr");t.innerHTML=`\n                <td><img src="${e.avatar}" alt="Avatar" class="friend-avatar"></td>\n                <td>${e.nickname}</td>\n                <td>\n                    <button class="accept-btn">Accept</button>\n                    <button class="decline-btn">Decline</button>\n                </td>\n            `,i.appendChild(t)}))),function(e,t){m.textContent=e,r.disabled=1===e,y.disabled=e===Math.ceil(t/5)}(e,n.length)}document.addEventListener("DOMContentLoaded",(()=>{(function(){const e=document.getElementById("LoginSignUp-popup"),t=e.querySelector(".close"),n=document.getElementById("loginForm"),a=document.getElementById("signupForm"),s=document.getElementById("show-login"),c=document.getElementById("show-signup"),d=document.getElementById("Login-btn"),i=document.getElementById("profile"),r=document.getElementById("Logout-btn"),y=document.getElementById("Wallet_set"),m=document.getElementById("connect_wallet"),u=document.getElementById("game_ui"),p=localStorage.getItem("user_name");if(console.log(p),null!=p){y.style.display="block";const e=localStorage.getItem("bio"),t=localStorage.getItem("photoBase64");u.style.display="block",d.style.display="none",r.style.display="block",document.getElementById("user-nickname").innerText=localStorage.getItem("nick_name"),e&&(document.getElementById("user-bio-display").innerText=e),t&&(document.getElementById("user-avatar-image").src=t)}else y.style.display="none",i.style.display="none",d.style.display="block";d.addEventListener("click",(()=>{e.style.display="block"})),t.addEventListener("click",(()=>{e.style.display="none",a.style.display="flex",n.style.display="none"})),c.addEventListener("click",(e=>{e.preventDefault(),a.style.display="flex",n.style.display="none",a.classList.add("form-style")})),s.addEventListener("click",(e=>{e.preventDefault(),n.style.display="flex",a.style.display="none",n.classList.add("form-style")})),a.addEventListener("submit",(async t=>{t.preventDefault();const s=a.querySelector("#username").value,c=a.querySelector("#nickname").value,d=a.querySelector("#password").value,i={user_name:s,nick_name:c,password:d};if(d===a.querySelector("#confirmpassword").value)try{o();const t=await fetch("http://localhost:3000/api/users/signup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(l(),t.ok){const o=await t.json();alert(o.message),a.reset(),e.style.display="none",n.style.display="flex",a.style.display="none"}else{const e=await t.json();alert("Sign up failed:",e.message)}}catch(e){console.error("Error:",e),alert("Sign up failed:",e)}else alert("Password doesn't match")})),n.addEventListener("submit",(async t=>{t.preventDefault();const a=n.querySelector("#usernameLogin").value,s=n.querySelector("#passwordLogin").value;o();try{const t=await fetch("http://localhost:3000/api/users/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_name:a,password:s})});if(l(),t.ok){m.style.display="block";const n=await t.json();alert(n.message),await async function(e){const t=document.getElementById("user-nickname"),n=document.getElementById("user-bio-display"),o=document.getElementById("user-avatar-image");try{const l=await fetch(`\n            http://localhost:3000/api/users/info?user_name=${encodeURIComponent(e)}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(l.ok){const a=(await l.json()).recordset[0];localStorage.setItem("user_name",e),localStorage.setItem("nick_name",a.Nick_name),localStorage.setItem("photoBase64",a.PhotoBase64),localStorage.setItem("bio",a.Bio),t.innerText=a.Nick_name,null!=a.Bio&&(n.innerText=a.Bio),null!=a.PhotoBase64&&(o.src=a.PhotoBase64)}else{const e=await l.json();alert(e.message)}}catch(e){console.error(e),alert("Login failed:",e)}}(a),d.style.display="none",r.style.display="block",e.style.display="none",u.style.display="block"}else{const e=await t.json();alert(e.message)}}catch(e){console.error("Error:",e),alert("Login failed:",e)}})),r.addEventListener("click",(()=>{m.style.display="none",localStorage.clear(),window.location.reload(),document.getElementById("Logout-btn").style.display="none",document.getElementById("Login-btn").style.display="display"}))})(),function(){const e=document.getElementById("game_ui"),t=document.getElementById("user-bio-display"),n=document.getElementById("user-bio-edit"),o=document.getElementById("edit-bio-button"),l=document.getElementById("save-bio-button"),a=document.getElementById("user-avatar-image"),s=document.getElementById("avatar-upload-input"),c=document.getElementById("user-back-button"),d=document.getElementById("profile");function i(){s.click()}c.addEventListener("click",(()=>{d.style.display="none",e.style.display="block"})),o.addEventListener("click",(()=>{n.value=t.innerText,n.style.display="block",t.style.display="none",o.style.display="none",l.style.display="block",a.classList.add("upload-mode"),a.addEventListener("click",i)})),l.addEventListener("click",(async()=>{t.innerText=n.value,n.style.display="none",t.style.display="block",o.style.display="block",l.style.display="none",a.classList.remove("upload-mode"),a.removeEventListener("click",i);const e=n.value,s=a.src,c=localStorage.getItem("user_name");(await fetch("http://localhost:3000/api/users/info",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({updateBio:e,photoBase64:s,user_name:c})})).ok?alert("Successfully saved"):alert("Saved Error")})),s.addEventListener("change",(e=>{const t=e.target.files[0];if(t){const e=new FileReader;e.onload=e=>{a.src=e.target.result},e.readAsDataURL(t)}}))}(),function(){const e=document.getElementById("game_ui"),t=document.getElementById("stretch_ui"),n=document.getElementById("stretch-button"),o=document.getElementById("back-button"),l=document.getElementById("bonk_ui"),a=document.getElementById("Bonk-button"),s=document.getElementById("start-stretch-button"),c=document.getElementById("stop-stretch-button"),d=document.getElementById("wallet-overlay"),i=document.getElementById("connect-wallet-button"),r=document.getElementById("connect_wallet"),y=document.getElementById("user-info-button"),m=document.getElementById("profile"),u=document.getElementById("friends-button"),p=document.getElementById("friend");u.addEventListener("click",(()=>{p.style.display="block",e.style.display="none"})),y.addEventListener("click",(()=>{m.style.display="block",e.style.display="none"})),n.addEventListener("click",(()=>{e.style.display="none",t.style.display="block"})),o.addEventListener("click",(()=>{t.style.display="none",e.style.display="block"})),a.addEventListener("click",(()=>{e.style.display="none",l.style.display="block",async function(){const e=await fetch("http://localhost:3000/api/GetStretch",{method:"GET",headers:{"Content-Type":"application/json"}});var t=await e.json();t=t.recordset,console.log(t)}()})),i.addEventListener("click",(()=>{r.click(),d.style.display="none"})),s.addEventListener("click",(async()=>{await fetch(`http://localhost:3000/api/ChangeStretch?user_name=${localStorage.getItem("user_name")}&action=true`,{method:"GET",headers:{"Content-Type":"application/json"}})&&(s.style.display="none",c.style.display="block")})),c.addEventListener("click",(async()=>{await fetch(`http://localhost:3000/api/ChangeStretch?user_name=${localStorage.getItem("user_name")}&action=`,{method:"GET",headers:{"Content-Type":"application/json"}})&&(s.style.display="block",c.style.display="none")}))}(),async function(){const e=document.getElementById("connect_wallet"),o=document.getElementById("wallet-overlay"),l=document.getElementById("Wallet_Contrel"),a=document.getElementById("Copy_Address"),s=document.getElementById("Disconnect"),c=document.getElementById("Wallet_set");if(localStorage.getItem("isConnectWallet")){var d=(await t()).publicKey.toString();e.innerText=d.slice(0,4)+"..."+d.slice(d.length-5,d.length-1),o.style.display="none"}e.addEventListener("click",(async n=>{var l=await t();l!={}?(n=l.publicKey.toString(),e.innerText=n.slice(0,4)+"..."+n.slice(n.length-5,n.length-1),o.style.display="none",localStorage.setItem("isConnectWallet",!0)):("phantom"in window||window.open("https://phantom.app/","_blank"),localStorage.removeItem("isConnectWallet"))})),document.getElementById("connect_wallet").addEventListener("mouseover",(()=>{null!=window.solana.publicKey&&(l.style.display="block")})),a.addEventListener("click",n),s.addEventListener("click",(()=>{!async function(){if(window.solana&&window.solana.isPhantom)try{window.solana.isConnected&&(await window.solana.disconnect(),console.log("Disconnected"))}catch(e){console.log("Error:",e)}else console.log("not found wallet")}(),e.innerText="connect",l.style.display="none",o.style.display="flex"})),c.addEventListener("mouseleave",(()=>{l.style.display="none"}))}(),p.addEventListener("click",(()=>{d="friends",c=1,p.classList.add("active"),g.classList.remove("active"),f(c,d)})),g.addEventListener("click",(()=>{d="invites",c=1,p.classList.remove("active"),g.classList.add("active"),f(c,d)})),r.addEventListener("click",(()=>{c>1&&(c--,f(c,d))})),y.addEventListener("click",(()=>{c<Math.ceil(("friends"===d?a:s).length/5)&&(c++,f(c,d))})),u.addEventListener("click",(()=>{v.style.display="block",b.style.display="none"})),f(c,d),document.querySelectorAll(".navbar a").forEach((t=>{t.addEventListener("click",(function(t){t.preventDefault(),e(this.getAttribute("href"),1e3)}))}));const i=document.getElementsByClassName("Guide_To_User_Info");Array.prototype.forEach.call(i,(function(t){t.addEventListener("click",(function(){e("#User_Info",1e3)}))}))}))})();